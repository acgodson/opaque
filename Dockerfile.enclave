FROM --platform=linux/amd64 node:20-slim

RUN apt-get update && apt-get install -y python3 iproute2 && rm -rf /var/lib/apt/lists/*

WORKDIR /app

COPY packages/enclave/dist ./packages/enclave/dist
COPY packages/enclave/vsock-bridge.py ./packages/enclave/
COPY packages/enclave/start.sh ./packages/enclave/

RUN chmod +x /app/packages/enclave/start.sh

EXPOSE 5000

CMD ["/app/packages/enclave/start.sh"]